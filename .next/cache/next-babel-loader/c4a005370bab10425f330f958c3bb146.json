{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime-corejs2/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"C:\\\\Users\\\\Artur\\\\Documents\\\\Programming\\\\ig\\\\relay\\\\www\\\\client\\\\utils\\\\withRestricted.tsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Router from 'next/router';\nimport { useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport cookie from 'js-cookie';\n\nconst mapStateToProps = state => ({\n  logged: Boolean(state.user)\n});\n\nconst mapDispatchToProps = dispatch => ({\n  logout: () => dispatch({\n    type: 'logout'\n  })\n});\n\nexport default (WrappedPage => {\n  const WrapperPage = (_ref) => {\n    let {\n      logged,\n      logout\n    } = _ref,\n        props = _objectWithoutProperties(_ref, [\"logged\", \"logout\"]);\n\n    const checkForLogout = event => {\n      if (event.key !== 'logout') return;\n      cookie.remove('token');\n      logout();\n      console.log('Logged out using browser storage');\n    };\n\n    useEffect(() => {\n      window.addEventListener('storage', checkForLogout);\n      return () => {\n        window.removeEventListener('storage', checkForLogout);\n        window.localStorage.removeItem('logout');\n      };\n    }, []);\n    if (!logged) Router.replace('/');\n    return __jsx(WrappedPage, _extends({}, props, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 40\n      },\n      __self: this\n    }));\n  };\n\n  WrapperPage.getInitialProps = async ctx => {\n    const {\n      checkedAuth,\n      user\n    } = ctx.store.getState();\n    if (!checkedAuth) console.error(`Wtf! checkedAuth is not true`);\n\n    if (user === null) {\n      false ? Router.replace('/') : ctx.res.writeHead(302, {\n        Location: '/'\n      }).end();\n    }\n\n    return _objectSpread({}, WrappedPage.getInitialProps && (await WrappedPage.getInitialProps(ctx)));\n  };\n\n  return connect(mapStateToProps, mapDispatchToProps)(WrapperPage);\n});","map":{"version":3,"sources":["C:/Users/Artur/Documents/Programming/ig/relay/www/client/utils/withRestricted.tsx"],"names":["Router","useEffect","connect","cookie","mapStateToProps","state","logged","Boolean","user","mapDispatchToProps","dispatch","logout","type","WrappedPage","WrapperPage","props","checkForLogout","event","key","remove","console","log","window","addEventListener","removeEventListener","localStorage","removeItem","replace","getInitialProps","ctx","checkedAuth","store","getState","error","res","writeHead","Location","end"],"mappings":";;;;;;;;;;;;;;;;;AAAA,OAAOA,MAAP,MAAmB,aAAnB;AAEA,SAASC,SAAT,QAA0B,OAA1B;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAOC,MAAP,MAAmB,WAAnB;;AAEA,MAAMC,eAAe,GAAIC,KAAD,KAAY;AAClCC,EAAAA,MAAM,EAAEC,OAAO,CAACF,KAAK,CAACG,IAAP;AADmB,CAAZ,CAAxB;;AAIA,MAAMC,kBAAkB,GAAIC,QAAD,KAAe;AACxCC,EAAAA,MAAM,EAAE,MACND,QAAQ,CAAC;AAAEE,IAAAA,IAAI,EAAE;AAAR,GAAD;AAF8B,CAAf,CAA3B;;AAKA,gBAAgBC,WAAD,IAAgC;AAC7C,QAAMC,WAAW,GAAG,UAAkC;AAAA,QAAjC;AAAER,MAAAA,MAAF;AAAUK,MAAAA;AAAV,KAAiC;AAAA,QAAZI,KAAY;;AAEpD,UAAMC,cAAc,GAAGC,KAAK,IAAI;AAC9B,UAAGA,KAAK,CAACC,GAAN,KAAc,QAAjB,EACE;AAEFf,MAAAA,MAAM,CAACgB,MAAP,CAAc,OAAd;AACAR,MAAAA,MAAM;AACNS,MAAAA,OAAO,CAACC,GAAR,CAAY,kCAAZ;AACD,KAPD;;AASApB,IAAAA,SAAS,CAAC,MAAM;AACdqB,MAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmCP,cAAnC;AAEA,aAAO,MAAM;AACXM,QAAAA,MAAM,CAACE,mBAAP,CAA2B,SAA3B,EAAsCR,cAAtC;AACAM,QAAAA,MAAM,CAACG,YAAP,CAAoBC,UAApB,CAA+B,QAA/B;AACD,OAHD;AAID,KAPQ,EAON,EAPM,CAAT;AASA,QAAG,CAACpB,MAAJ,EACEN,MAAM,CAAC2B,OAAP,CAAe,GAAf;AAEF,WAAO,MAAC,WAAD,eAAiBZ,KAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAP;AACD,GAxBD;;AA0BAD,EAAAA,WAAW,CAACc,eAAZ,GAA8B,MAAMC,GAAN,IAAa;AACzC,UAAM;AAAEC,MAAAA,WAAF;AAAetB,MAAAA;AAAf,QAAwBqB,GAAG,CAACE,KAAJ,CAAUC,QAAV,EAA9B;AAEA,QAAG,CAACF,WAAJ,EACEV,OAAO,CAACa,KAAR,CAAe,8BAAf;;AAEF,QAAGzB,IAAI,KAAK,IAAZ,EAAiB;AACf,cACIR,MAAM,CAAC2B,OAAP,CAAe,GAAf,CADJ,GAEIE,GAAG,CAACK,GAAJ,CAAQC,SAAR,CAAkB,GAAlB,EAAuB;AAAEC,QAAAA,QAAQ,EAAE;AAAZ,OAAvB,EAA0CC,GAA1C,EAFJ;AAGD;;AAED,6BACMxB,WAAW,CAACe,eAAZ,KAAgC,MAAMf,WAAW,CAACe,eAAZ,CAA4BC,GAA5B,CAAtC,CADN;AAGD,GAfD;;AAiBA,SAAO3B,OAAO,CAACE,eAAD,EAAkBK,kBAAlB,CAAP,CAA6CK,WAA7C,CAAP;AACD,CA7CD","sourcesContent":["import Router from 'next/router'\r\nimport { NextPage } from 'next'\r\nimport { useEffect } from 'react'\r\nimport { connect } from 'react-redux'\r\nimport cookie from 'js-cookie'\r\n\r\nconst mapStateToProps = (state) => ({\r\n  logged: Boolean(state.user)\r\n})\r\n\r\nconst mapDispatchToProps = (dispatch) => ({\r\n  logout: () =>\r\n    dispatch({ type: 'logout' })\r\n})\r\n\r\nexport default (WrappedPage: NextPage<any>) => {\r\n  const WrapperPage = ({ logged, logout, ...props }) => {\r\n\r\n    const checkForLogout = event => {\r\n      if(event.key !== 'logout')\r\n        return\r\n\r\n      cookie.remove('token')\r\n      logout()\r\n      console.log('Logged out using browser storage')\r\n    }\r\n\r\n    useEffect(() => {\r\n      window.addEventListener('storage', checkForLogout)\r\n\r\n      return () => {\r\n        window.removeEventListener('storage', checkForLogout)\r\n        window.localStorage.removeItem('logout')\r\n      }\r\n    }, [])\r\n\r\n    if(!logged)\r\n      Router.replace('/')\r\n\r\n    return <WrappedPage {...props} />\r\n  }\r\n\r\n  WrapperPage.getInitialProps = async ctx => {\r\n    const { checkedAuth, user } = ctx.store.getState()\r\n\r\n    if(!checkedAuth)\r\n      console.error(`Wtf! checkedAuth is not true`)\r\n\r\n    if(user === null){\r\n      process.browser\r\n        ? Router.replace('/')\r\n        : ctx.res.writeHead(302, { Location: '/' }).end()\r\n    }\r\n\r\n    return { \r\n      ...(WrappedPage.getInitialProps && (await WrappedPage.getInitialProps(ctx)))\r\n    }\r\n  }\r\n\r\n  return connect(mapStateToProps, mapDispatchToProps)(WrapperPage)\r\n}"]},"metadata":{},"sourceType":"module"}