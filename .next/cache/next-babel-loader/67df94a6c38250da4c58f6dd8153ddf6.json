{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport fetch from 'isomorphic-unfetch';\nimport getServerHost from './getServerHost';\nimport nextCookie from 'next-cookies';\nimport cookie from 'js-cookie';\nexport default (function _callee(ctx) {\n  var token, response;\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          token = '';\n\n          if (!(ctx === undefined)) {\n            _context.next = 8;\n            break;\n          }\n\n          if (true) {\n            _context.next = 5;\n            break;\n          }\n\n          console.error(\"Missing ctx in getUser\");\n          return _context.abrupt(\"return\", null);\n\n        case 5:\n          token = cookie.get('token');\n          _context.next = 9;\n          break;\n\n        case 8:\n          token = nextCookie(ctx).token;\n\n        case 9:\n          _context.prev = 9;\n          _context.next = 12;\n          return _regeneratorRuntime.awrap(fetch(\"\".concat(getServerHost(ctx === null || ctx === void 0 ? void 0 : ctx.req), \"/auth/user\"), {\n            headers: {\n              Authorization: \"Bearer \".concat(token)\n            }\n          }));\n\n        case 12:\n          response = _context.sent;\n\n          if (!response.ok) {\n            _context.next = 19;\n            break;\n          }\n\n          _context.next = 16;\n          return _regeneratorRuntime.awrap(response.json());\n\n        case 16:\n          return _context.abrupt(\"return\", _context.sent);\n\n        case 19:\n          return _context.abrupt(\"return\", null);\n\n        case 20:\n          _context.next = 25;\n          break;\n\n        case 22:\n          _context.prev = 22;\n          _context.t0 = _context[\"catch\"](9);\n          return _context.abrupt(\"return\", null);\n\n        case 25:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[9, 22]]);\n});","map":{"version":3,"sources":["C:/Users/Artur/Documents/Programming/ig/relay/www/client/utils/getUser.ts"],"names":["fetch","getServerHost","nextCookie","cookie","ctx","token","undefined","console","error","get","req","headers","Authorization","response","ok","json"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,oBAAlB;AACA,OAAOC,aAAP,MAA0B,iBAA1B;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,MAAP,MAAmB,WAAnB;AAEA,gBAAe,iBAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACTC,UAAAA,KADS,GACD,EADC;;AAAA,gBAGVD,GAAG,KAAKE,SAHE;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAKTC,UAAAA,OAAO,CAACC,KAAR;AALS,2CAMF,IANE;;AAAA;AASXH,UAAAA,KAAK,GAAGF,MAAM,CAACM,GAAP,CAAW,OAAX,CAAR;AATW;AAAA;;AAAA;AAWXJ,UAAAA,KAAK,GAAGH,UAAU,CAACE,GAAD,CAAV,CAAgBC,KAAxB;;AAXW;AAAA;AAAA;AAAA,2CAeYL,KAAK,WAAIC,aAAa,CAACG,GAAD,aAACA,GAAD,uBAACA,GAAG,CAAEM,GAAN,CAAjB,iBAAyC;AAAEC,YAAAA,OAAO,EAAE;AAAEC,cAAAA,aAAa,mBAAYP,KAAZ;AAAf;AAAX,WAAzC,CAfjB;;AAAA;AAeLQ,UAAAA,QAfK;;AAAA,eAiBRA,QAAQ,CAACC,EAjBD;AAAA;AAAA;AAAA;;AAAA;AAAA,2CAkBID,QAAQ,CAACE,IAAT,EAlBJ;;AAAA;AAAA;;AAAA;AAAA,2CAoBF,IApBE;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,2CAuBJ,IAvBI;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAf","sourcesContent":["import fetch from 'isomorphic-unfetch'\r\nimport getServerHost from './getServerHost'\r\nimport nextCookie from 'next-cookies'\r\nimport cookie from 'js-cookie'\r\n\r\nexport default async (ctx?: any) => {\r\n  let token = ''\r\n\r\n  if(ctx === undefined){\r\n    if(!process.browser){\r\n      console.error(`Missing ctx in getUser`)\r\n      return null\r\n    }\r\n\r\n    token = cookie.get('token')\r\n  } else {\r\n    token = nextCookie(ctx).token\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(`${getServerHost(ctx?.req)}/auth/user`, { headers: { Authorization: `Bearer ${token}` } })\r\n\r\n    if(response.ok){\r\n      return await response.json()\r\n    } else {\r\n      return null\r\n    }\r\n  } catch (error) {\r\n    return null\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}