{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"C:\\\\Users\\\\Artur\\\\Documents\\\\Programming\\\\ig\\\\relay\\\\www\\\\client\\\\pages\\\\_app.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport App from 'next/app';\nimport Head from 'next/head';\nimport { ThemeProvider } from '@material-ui/styles';\nimport theme from '@material-ui/core/styles/defaultTheme';\nimport { createStore } from \"redux\";\nimport { Provider } from \"react-redux\";\nimport withRedux from \"next-redux-wrapper\";\nimport getUser from '../utils/getUser';\n\nvar initialState = function initialState() {\n  return {\n    checkedAuth: false,\n    user: null,\n    bot: {\n      currentAccount: null\n    }\n  };\n};\n\nvar reducer = function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState();\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case 'checkedAuth':\n      return _objectSpread({}, state, {\n        checkedAuth: true\n      });\n\n    case 'login':\n      return _objectSpread({}, state, {\n        user: action.payload\n      });\n\n    case 'logout':\n      return _objectSpread({}, state, {\n        user: null\n      });\n\n    case 'setCurrentAccount':\n      return _objectSpread({}, state, {\n        bot: _objectSpread({}, state.bot, {\n          currentAccount: action.payload\n        })\n      });\n\n    default:\n      return state;\n  }\n};\n/**\r\n* @param {object} initialState\r\n* @param {boolean} options.isServer indicates whether it is a server side or client side\r\n* @param {Request} options.req NodeJS Request object (not set when client applies initialState from server)\r\n* @param {Request} options.res NodeJS Request object (not set when client applies initialState from server)\r\n* @param {boolean} options.debug User-defined debug mode param\r\n* @param {string} options.storeKey This key will be used to preserve store in global namespace for safe HMR \r\n*/\n\n\nvar makeStore = function makeStore(initialState, options) {\n  return createStore(reducer, initialState);\n};\n\nvar MyApp =\n/*#__PURE__*/\nfunction (_App) {\n  _inherits(MyApp, _App);\n\n  function MyApp() {\n    _classCallCheck(this, MyApp);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(MyApp).apply(this, arguments));\n  }\n\n  _createClass(MyApp, [{\n    key: \"render\",\n    value: function render() {\n      //@ts-ignore\n      var _this$props = this.props,\n          Component = _this$props.Component,\n          pageProps = _this$props.pageProps,\n          store = _this$props.store;\n      return __jsx(Provider, {\n        store: store,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103\n        },\n        __self: this\n      }, __jsx(Head, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      }, __jsx(\"title\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      }, \"InstaFeed\")), __jsx(ThemeProvider, {\n        theme: theme,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107\n        },\n        __self: this\n      }, __jsx(Component, _extends({}, pageProps, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108\n        },\n        __self: this\n      }))));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    // Only uncomment this method if you have blocking data requirements for\n    // every single page in your application. This disables the ability to\n    // perform automatic static optimization, causing every page in your app to\n    // be server-side rendered.\n    //\n    // static async getInitialProps(appContext) {\n    //   // calls page's `getInitialProps` and fills `appProps.pageProps`\n    //   const appProps = await App.getInitialProps(appContext);\n    //\n    //   return { ...appProps }\n    // }\n    value: function getInitialProps(_ref) {\n      var Component, ctx, user, pageProps;\n      return _regeneratorRuntime.async(function getInitialProps$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              Component = _ref.Component, ctx = _ref.ctx;\n\n              if (ctx.store.getState().checkedAuth) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(getUser(ctx));\n\n            case 4:\n              user = _context.sent;\n              if (user) ctx.store.dispatch({\n                type: 'login',\n                payload: user\n              });\n              ctx.store.dispatch({\n                type: 'checkedAuth'\n              });\n\n            case 7:\n              if (!Component.getInitialProps) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 10;\n              return _regeneratorRuntime.awrap(Component.getInitialProps(ctx));\n\n            case 10:\n              _context.t0 = _context.sent;\n              _context.next = 14;\n              break;\n\n            case 13:\n              _context.t0 = {};\n\n            case 14:\n              pageProps = _context.t0;\n              return _context.abrupt(\"return\", {\n                pageProps: pageProps\n              });\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    }\n  }]);\n\n  return MyApp;\n}(App);\n\nexport default withRedux(makeStore)(MyApp);","map":{"version":3,"sources":["C:/Users/Artur/Documents/Programming/ig/relay/www/client/pages/_app.tsx"],"names":["React","App","Head","ThemeProvider","theme","createStore","Provider","withRedux","getUser","initialState","checkedAuth","user","bot","currentAccount","reducer","state","action","type","payload","makeStore","options","MyApp","props","Component","pageProps","store","ctx","getState","dispatch","getInitialProps"],"mappings":"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","sourcesContent":["import React from 'react'\r\nimport App from 'next/app'\r\nimport Head from 'next/head'\r\nimport { ThemeProvider } from '@material-ui/styles'\r\nimport theme from '@material-ui/core/styles/defaultTheme'\r\nimport { createStore } from \"redux\"\r\nimport { Provider } from \"react-redux\"\r\nimport withRedux from \"next-redux-wrapper\"\r\nimport { Account } from '../types/Account'\r\nimport { User } from '../types/User'\r\nimport getUser from '../utils/getUser'\r\n\r\ntype State = {\r\n  checkedAuth: boolean,\r\n  user: null | User\r\n  bot: {\r\n    currentAccount: null | Account\r\n  }\r\n}\r\n\r\nconst initialState = (): State => ({\r\n  checkedAuth: false,\r\n  user: null,\r\n  bot: {\r\n    currentAccount: null\r\n  }\r\n})\r\n\r\nconst reducer = (state = initialState(), action) => {\r\n  switch (action.type) {\r\n    case 'checkedAuth':\r\n      return {\r\n        ...state,\r\n        checkedAuth: true\r\n      }\r\n    case 'login':\r\n      return {\r\n        ...state,\r\n        user: action.payload\r\n      }\r\n    case 'logout':\r\n      return {\r\n        ...state,\r\n        user: null\r\n      }\r\n    case 'setCurrentAccount':\r\n      return {\r\n        ...state, \r\n        bot: {\r\n          ...state.bot,\r\n          currentAccount: action.payload\r\n        }\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\n/**\r\n* @param {object} initialState\r\n* @param {boolean} options.isServer indicates whether it is a server side or client side\r\n* @param {Request} options.req NodeJS Request object (not set when client applies initialState from server)\r\n* @param {Request} options.res NodeJS Request object (not set when client applies initialState from server)\r\n* @param {boolean} options.debug User-defined debug mode param\r\n* @param {string} options.storeKey This key will be used to preserve store in global namespace for safe HMR \r\n*/\r\nconst makeStore = (initialState, options) => {\r\n  return createStore(reducer, initialState);\r\n}\r\n\r\n\r\nclass MyApp extends App {\r\n  // Only uncomment this method if you have blocking data requirements for\r\n  // every single page in your application. This disables the ability to\r\n  // perform automatic static optimization, causing every page in your app to\r\n  // be server-side rendered.\r\n  //\r\n  // static async getInitialProps(appContext) {\r\n  //   // calls page's `getInitialProps` and fills `appProps.pageProps`\r\n  //   const appProps = await App.getInitialProps(appContext);\r\n  //\r\n  //   return { ...appProps }\r\n  // }\r\n\r\n  static async getInitialProps({ Component, ctx }) {\r\n    if(!ctx.store.getState().checkedAuth){\r\n      const user = await getUser(ctx)\r\n      if(user)\r\n        ctx.store.dispatch({ type: 'login', payload: user })\r\n\r\n      ctx.store.dispatch({ type: 'checkedAuth' })\r\n    }\r\n\r\n    const pageProps = Component.getInitialProps ? await Component.getInitialProps(ctx) : {};\r\n\r\n    return { pageProps };\r\n  }\r\n\r\n  render() {\r\n    //@ts-ignore\r\n    const { Component, pageProps, store } = this.props\r\n    return (\r\n      <Provider store={store}>\r\n        <Head>\r\n          <title>InstaFeed</title>\r\n        </Head>\r\n        <ThemeProvider theme={theme}>\r\n          <Component {...pageProps} />\r\n        </ThemeProvider>\r\n      </Provider>\r\n    )\r\n  }\r\n}\r\n\r\nexport default withRedux(makeStore)(MyApp)"]},"metadata":{},"sourceType":"module"}